<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Gemini éŸ³å£°ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</title>
</head>
<body>
    <h1>ğŸ¤ Gemini éŸ³å£°ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</h1>
    <button id="recordBtn">ğŸ”´ REC</button>
    <form id="textForm">
        <input type="text" id="textInput" placeholder="ã“ã“ã«å…¥åŠ›..." />
        <button type="submit">é€ä¿¡</button>
    </form>
    <div id="response"></div>
    <script>
        const btn = document.getElementById("recordBtn");
        const form = document.getElementById("textForm");
        const input = document.getElementById("textInput");
        const responseDiv = document.getElementById("response");
        let mediaRecorder, chunks = [];

        btn.onmousedown = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            chunks = [];
            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = async () => {
                const blob = new Blob(chunks, { type: "audio/webm" });
                const formData = new FormData();
                formData.append("audio", blob);
                fetch("/transcribe", {
                    method: "POST",
                    body: formData
                }).then(res => res.json()).then(data => {
                    responseDiv.innerText = data.text;
                    if (data.audio_url) {
                        const audio = new Audio(data.audio_url);
                        audio.play();
                    }
                });
            };
            mediaRecorder.start();
            btn.innerText = "ğŸ›‘ Stop";
        };

        btn.onmouseup = () => {
            mediaRecorder?.stop();
            btn.innerText = "ğŸ”´ REC";
        };

        form.onsubmit = e => {
            e.preventDefault();
            const formData = new FormData();
            formData.append("text", input.value);
            fetch("/transcribe", {
                method: "POST",
                body: formData
            }).then(res => res.json()).then(data => {
                responseDiv.innerText = data.text;
                if (data.audio_url) {
                    const audio = new Audio(data.audio_url);
                    audio.play();
                }
            });
        };
    </script>
</body>
</html>
